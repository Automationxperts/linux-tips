function weather() {
	if [[ -z $1 ]]; then
		curl wttr.in/$1
	elif [[ -z $CITY ]]; then
		curl wttr.in/$CITY
	else
		echo "Please specify city!"
	fi
}

function find_big_files() {
    find . -size +"$1" -type f -print0 | xargs -0 ls -Ssh | sort -z
}

# Colorize output of man command
# http://tuxdiary.com/2016/06/16/color-man-pages/#more-27324
function man() {
    env \
    LESS_TERMCAP_mb=$'\e[01;31m' \
    LESS_TERMCAP_md=$'\e[01;31m' \
    LESS_TERMCAP_me=$'\e[0m' \
    LESS_TERMCAP_se=$'\e[0m' \
    LESS_TERMCAP_so=$'\e[01;44;33m' \
    LESS_TERMCAP_ue=$'\e[0m' \
    LESS_TERMCAP_us=$'\e[01;32m' \
    man "$@"
}

# Create a directory and change to it
function mcd() {
	mkdir -pv $1
	cd $1
}

# Use xdg-open in a subshell, derived output and detached
function open() {
    (nohup xdg-open "$1" >/dev/null 2>&1 &)
}

# Get latest statistics for COVID-19 in USA
function coronavirus_cases() {
	curl -s https://corona-stats.online/GT?minimal=true | head -n 3 | awk '{ print $2 $3 "\t"$5 "\t"$6 "\t" $7 "\t" $8 $9 "\t" $10 $11  }'
}

# Generate a random alphanumeric password
function genpass() {
	local passlen=${1:-32}		# Default length is 32 characters
	LC_ALL=C tr -cd '[:alnum:]' < /dev/urandom | fold -w $passlen | head -n1
}

# Display headers from a web site/URL (requires cURL)
function headers() {
	curl -sv "$@" 2>&1 >/dev/null |
		grep -v "^\*" |
		grep -v "^}" |
		cut -c3-
}

# Simple command-line calculator
function = {
    # declare -i i=${1:-$(</dev/stdin)};
    # echo "$i" | bc -l
    echo "$@" | bc -l
}
alias calc="="

# Get public IP address
function whats-my-ip() {
    ip=`curl --silent https://httpbin.org/ip | jq -r .origin`
    echo $ip | xclip -selection clipboard
    notify-send -t 5000 "$ip copied to clipboard."
}

function dirsize() {
    sudo du -cxh -d 1 . | sort -h;
}

# Go up the specified number of directory levels (e.g., "up 4")
function up() {
	local d=""
	limit=$1
	for ((i=1 ; i <= limit ; i++))
		do
			d="$d"/..
		done
	d=$(echo $d | sed 's/^\///')
	if [[ -z "$d" ]]; then
		d=..
	fi
	cd "$d"
}

# Colorize tail output for log files based on type of message on line
# https://github.com/cgoldberg/dotfiles/blob/master/.bash_aliases#L548
function ctail() {
    tail -f -n 80 "$1" |
        sed --unbuffered \
        -e 's/\(.*FATAL.*\)/\o033[31m\1\o033[39m/' \
        -e 's/\(.*ERROR.*\)/\o033[31m\1\o033[39m/' \
        -e 's/\(.*WARN.*\)/\o033[33m\1\o033[39m/' \
        -e 's/\(.*INFO.*\)/\o033[32m\1\o033[39m/' \
        -e 's/\(.*DEBUG.*\)/\o033[34m\1\o033[39m/' \
        -e 's/\(.*TRACE.*\)/\o033[30m\1\o033[39m/' \
        -e 's/\(.*[Ee]xception.*\)/\o033[39m\1\o033[39m/'
}

# Search command history by regex (case-insensitive) and show last n matches
# usage: hs <pattern>
# https://github.com/cgoldberg/dotfiles/blob/master/.bash_aliases#L271
function hs() {
    local n="150"
    history | grep -i --color=always "$1" | tail -n "$n"
}

# Convert input string to all only lowercase alphanumeric characters separated with hyphens
# https://github.com/SixArm/sixarm-unix-shell-functions
function slugify() {
    printf %s\\n "$*" | sed 's/[^[:alnum:]]/_/g; s/--*/-/; s/^-*//; s/-*$//;' | tr '[[:upper:]]' '[[:lower:]]'
}

# Convert input string to all only alphanumeric characters separated with underscores
# https://github.com/SixArm/sixarm-unix-shell-functions
function snake_format() {
    printf %s\\n "$*" | sed 's/[^[:alnum:]]\{1,\}/_/g; s/_\{2,\}/_/g; s/^_\{1,\}//; s/_\{1,\}$//;'
}

# List files in current directory and sub-directories displayed as a tree
# https://github.com/SixArm/sixarm_unix_shell_scripts/blob/main/ls-tree
function lstree() {
    ls -R | grep ":$" | sed -e 's/:$//' -e 's/[^-][^\/]*\//--/g' -e 's/^/   /' -e 's/-/|/'
}

# Convert between JSON and YAML
# http://github.com/frgomes/bash-scripts
function json2yaml {
  python -c 'import sys, yaml, json; print(yaml.dump(json.loads(sys.stdin.read())))'
}

function yaml2json {
  python -c 'import sys, yaml, json; print(json.dumps(yaml.safe_load(sys.stdin.read())))'
}

alias ls='ls --group-directories-first --time-style=+"%m/%d/%Y %H:%M" --color=auto -F'
alias ll='ls -lrt --group-directories-first --time-style=+"%m/%d/%Y %H:%M" --color=auto -F'
alias la='ls -la --group-directories-first --time-style=+"%m/%d/%Y %H:%M" --color=auto -F'
# octal file modes through http://stackoverflow.com/questions/1795976/can-the-unix-list-command-ls-output-numerical-chmod-permissions
alias lsoct='ls -al --color=auto|awk '\''{k=0;s=0;for(i=0;i<=8;i++){;k+=((substr($1,i+2,1)~/[rwxst]/)*2^(8-i));};j=4;for(i=4;i<=10;i+=3){;s+=((substr($1,i,1)~/[stST]/)*j);j/=2;};if(k){;printf("%0o%0o ",s,k);};print;}'\'''

# System functions
# https://www.digitalocean.com/community/tutorials/an-introduction-to-useful-bash-aliases-and-functions
alias df="df -Tha --total"
alias du="du -ach | sort -h"
alias psg="ps aux | grep -v grep | grep -i -e VSZ -e"
alias path='printf "%b\n" "${PATH//:/\\n}"' # Pretty print $PATH

alias rm='rm -i -v'
alias cp='cp -v'
alias mv='mv -v'
alias mkdir='mkdir -pv'
alias top='htop'
alias apt-version='apt-cache madison'
alias more='less'

# Colorize output of ip command
alias ip='ip -c'

# Get public IP address
alias publicip='curl https://ipecho.net/plain; echo'

# Another method to get public IP using 'dig'
alias ext_ip="dig +short myip.opendns.com @resolver1.opendns.com"

# View HTTP traffic
# https://github.com/lacymorrow/dotfiles/blob/master/.aliases
alias sniff="sudo ngrep -d 'en1' -t '^(GET|POST) ' 'tcp and port 80'"
alias httpdump="sudo tcpdump -i en1 -n -s 0 -w - | grep -a -o -E \"Host\: .*|GET \/.*\""

# Searchable 'ps' command alias
alias psg="ps aux | grep -v grep | grep -i -e VSZ -e"

# Summary of top 10 commands from history
alias hist_summary='history | awk '\''{CMD[$2]++;count++;}END { for (a in CMD)print CMD[a] " " CMD[a]/count*100 "% " a;}'\'' | grep -v "./" | column -c3 -s " " -t | sort -nr | nl |  head -n10'

alias dateiso='date -u +"%Y-%m-%dT%H:%M:%SZ"'

# Git aliases
alias gitlog='git log --all --decorate --graph --oneline'
alias glog="git log --graph --pretty=format:'%Cred%h%Creset %an: %s - %Creset %C(yellow)%d%Creset %Cgreen(%cr)%Creset' --abbrev-commit --date=relative"
# Undo last commit, but don't throw away your changes.
alias git-undo="git reset --soft HEAD^"

# Run Docker GUI application in container.
# Specify the Docker container name on command line.
# Ensure that 'xhost' has been run prior to enable permissions to X11 display.
alias d-run="docker run --rm -it --net=host --cpuset-cpus 0 --memory 512mb -v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=unix$DISPLAY "

# Open a random 'man' page - Great way to learn new commands
alias randman="apropos . | shuf -n 1 | awk '{print$1}' | xargs man"

# Display information about Linux distribution, package management, etc.
alias distinfo="echo /etc/*_ver* /etc/*-rel*; cat /etc/*_ver* /etc/*-rel*"

# URL-encode strings
alias urlencode='python2 -c "import sys, urllib as ul; print ul.quote_plus(sys.argv[1]);"'

# Functionalize 'command -v' to allow 'if get_command [command]' idiom
# https://github.com/rawiriblundell/dotfiles/blob/master/.bashrc
get_command() {
  local errcount cmd
  case "${1}" in
    (-v|--verbose)
      shift 1
      errcount=0
      for cmd in "${@}"; do
        command -v "${cmd}" || 
          { printf -- '%s\n' "${cmd} not found"; (( errcount++ )); }
      done
      (( errcount == 0 )) && return 0
    ;;
    ('')
      printf -- '%s\n' "get_command [-v|--verbose] list of commands" \
        "get_command will emit return code 1 if any listed command is not found" >&2
      return 0
    ;;
    (*)
      errcount=0
      for cmd in "${@}"; do
        command -v "${1}" >/dev/null 2>&1 || (( errcount++ ))
      done
      (( errcount == 0 )) && return 0
    ;;
  esac
  # If we get to this point, we've failed
  return 1
}
alias exists="get_command"
alias is_command="get_command"

# Always run these commands with 'sudo'
for cmd in apt-get apt-cache update-grub shutdown reboot ; do
    alias $cmd="sudo $cmd"
done; unset cmd

# Use Neovim for Vim, if available
[ -x "$(command -v nvim)" ] && alias vim="nvim" vimdiff="nvim -d"

# `tre` is a shorthand for `tree` with hidden files and color enabled, ignoring
# the `.git` directory, listing directories first. The output gets piped into
# `less` with options to preserve color and line numbers, unless the output is
# small enough for one screen.
function tre() {
	tree -aC -I '.git|node_modules|bower_components' --dirsfirst "$@" | less -FRNX
}

# Show basic information from Wikipedia on command-line topic
# Requires 'jq'. (Install with 'sudo apt-get install -y jq'.)
function wikip() {
	LANG="en"
	if [[ -z $1 ]]; then
	  echo -e "No argument specified.\nUsage: wikip TOPIC\n"
	else
	  var=$(echo $* | sed 's/ /_/g')             # Transforms 'One Time' to 'One_Time'
	  wiki_data=$(curl -s "https://"$LANG".m.wikipedia.org/w/api.php?format=json&action=query&prop=extracts&exintro&explaintext&titles="$var"&redirects" | jq '.query.pages | to_entries[0] | .value.extract')
	  data=$(echo $wiki_data | sed 's/\\\"/"/g') # Removes \" characters
	  if [[ $data = "null" ]]; then
		echo "Nothing found. Check query/topic."
	  else
		url="https://en.m.wikipedia.org/wiki/"$var
		echo -e ${data:1:${#data}-2}"\n"
		echo "See more on "$url
	  fi
	fi	
}

